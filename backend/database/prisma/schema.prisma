generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  admin
  user
}

enum EmailStatus {
  PENDING_SEND
  SENT
  FAILED
  BOUNCED
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  passwordHash String?
  firstName    String?
  lastName     String?
  role         UserRole      @default(user)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  drafts       EmailDraft[]
  emails       Email[]
  oauth        OAuthConnection[]
}

model OAuthConnection {
  id            String   @id @default(uuid())
  userId        String
  provider      String
  emailAddress  String
  accessToken   String
  refreshToken  String?
  tokenExpiresAt DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id])
}

model EmailDraft {
  id          String   @id @default(uuid())
  userId      String
  workspaceId String?
  prospectId  String?
  subject     String?
  bodyHtml    String?
  bodyText    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id])
  prospect  Prospect? @relation(fields: [prospectId], references: [id])
  emails    Email[]
}

model Prospect {
  id           String   @id @default(uuid())
  workspaceId  String?
  email        String
  firstName    String?
  lastName     String?
  company      String?
  jobTitle     String?
  customFields Json     @default("{}")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  drafts EmailDraft[]
  emails Email[]
}

model CompanyData {
  id        String   @id @default(uuid())
  domain    String   @unique
  name      String?
  industry  String?
  size      String?
  location  String?
  metadata  Json     @default("{}")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Email {
  id               String      @id @default(uuid())
  draftId          String?
  userId           String
  workspaceId      String?
  prospectId       String?
  fromEmail        String
  toEmail          String
  subject          String
  bodyHtml         String
  bodyText         String?
  status           EmailStatus @default(PENDING_SEND)
  idempotencyKey   String      @unique
  providerMessageId String?
  sentAt           DateTime?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  user     User     @relation(fields: [userId], references: [id])
  draft    EmailDraft? @relation(fields: [draftId], references: [id])
  prospect Prospect? @relation(fields: [prospectId], references: [id])
}
