# AI Sales Email Copilot - Architecture Diagrams

## System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           CLIENT LAYER                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌──────────────┐      ┌──────────────┐      ┌──────────────┐          │
│  │   Web App    │      │   Chrome     │      │   Mobile     │          │
│  │   (React)    │      │   Extension  │      │   App (RN)   │          │
│  └──────────────┘      └──────────────┘      └──────────────┘          │
│         │                     │                     │                    │
│         └─────────────────────┼─────────────────────┘                    │
│                               │                                           │
└───────────────────────────────┼───────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        API GATEWAY LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                    API Gateway (Kong/AWS)                           │ │
│  │  • Authentication & Authorization                                   │ │
│  │  • Rate Limiting                                                   │ │
│  │  • Request Routing                                                 │ │
│  │  • Load Balancing                                                  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      APPLICATION LAYER                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │   Auth       │  │   Email      │  │   Campaign   │                  │
│  │   Service    │  │   Service    │  │   Service    │                  │
│  └──────────────┘  └──────────────┘  └──────────────┘                  │
│         │                 │                 │                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │   AI         │  │   Analytics  │  │   Sequence   │                  │
│  │   Service    │  │   Service    │  │   Service    │                  │
│  └──────────────┘  └──────────────┘  └──────────────┘                  │
│         │                 │                 │                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │ Integration  │  │   Team       │  │   Template   │                  │
│  │   Service    │  │   Service    │  │   Service    │                  │
│  └──────────────┘  └──────────────┘  └──────────────┘                  │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          DATA LAYER                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │  PostgreSQL  │  │    Redis     │  │ Elasticsearch│                  │
│  │  (Primary)   │  │  (Cache/     │  │  (Search)    │                  │
│  │              │  │   Queue)     │  │              │                  │
│  └──────────────┘  └──────────────┘  └──────────────┘                  │
│                                                                           │
│  ┌──────────────┐  ┌──────────────┐                                     │
│  │  S3/R2       │  │  Pinecone    │                                     │
│  │  (Storage)   │  │  (Vector DB) │                                     │
│  └──────────────┘  └──────────────┘                                     │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    EXTERNAL SERVICES                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐               │
│  │  Gmail   │  │ Outlook  │  │  OpenAI  │  │   CRM    │               │
│  │   API    │  │   API    │  │   API    │  │   APIs   │               │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘               │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    BACKGROUND WORKERS                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │
│  │   Email      │  │   Sequence    │  │   Analytics   │                 │
│  │   Worker     │  │   Worker      │  │   Worker      │                 │
│  └──────────────┘  └──────────────┘  └──────────────┘                 │
│                                                                           │
│  ┌──────────────┐  ┌──────────────┐                                     │
│  │   Webhook    │  │   Warmup      │                                     │
│  │   Worker     │  │   Worker      │                                     │
│  └──────────────┘  └──────────────┘                                     │
│                                                                           │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Data Flow: Email Send Process

```
┌─────────┐
│  User   │
└────┬────┘
     │ 1. Compose Email
     ▼
┌─────────────────┐
│  Frontend       │
│  (Composer)     │
└────┬────────────┘
     │ 2. POST /emails/send
     ▼
┌─────────────────┐
│  API Gateway    │
│  (Auth Check)   │
└────┬────────────┘
     │ 3. Validate Request
     ▼
┌─────────────────┐
│  Email Service  │
│  • Validate     │
│  • Replace Vars │
│  • Gen Tracking │
└────┬────────────┘
     │ 4. Queue Email Job
     ▼
┌─────────────────┐
│  Email Queue    │
│  (BullMQ/Redis) │
└────┬────────────┘
     │ 5. Process Job
     ▼
┌─────────────────┐
│  Email Worker   │
│  • Get OAuth    │
│  • Refresh Token│
│  • Send Email   │
└────┬────────────┘
     │ 6. Send via API
     ▼
┌─────────────────┐      ┌──────────────┐
│  Gmail/Outlook  │◄─────┤  Success     │
│      API        │      │  Update DB   │
└─────────────────┘      └──────────────┘
     │
     │ 7. Track Event
     ▼
┌─────────────────┐
│  Analytics      │
│  Service        │
└─────────────────┘
```

---

## Data Flow: AI Email Generation

```
┌─────────┐
│  User   │
└────┬────┘
     │ 1. Request AI Email
     ▼
┌─────────────────┐
│  Frontend       │
└────┬────────────┘
     │ 2. POST /ai/generate-email
     ▼
┌─────────────────┐
│  API Gateway   │
└────┬────────────┘
     │ 3. Route to AI Service
     ▼
┌─────────────────┐
│  AI Service     │
│  • Check Cache  │
│  • Build Prompt │
│  • Rate Limit   │
└────┬────────────┘
     │ 4. Call OpenAI API
     ▼
┌─────────────────┐
│  OpenAI API     │
│  (GPT-4)        │
└────┬────────────┘
     │ 5. Generated Email
     ▼
┌─────────────────┐
│  AI Service     │
│  • Cache Result │
│  • Format       │
└────┬────────────┘
     │ 6. Return to Frontend
     ▼
┌─────────────────┐
│  Frontend       │
│  (Display)      │
└─────────────────┘
```

---

## Data Flow: Campaign Execution

```
┌─────────┐
│  User   │
└────┬────┘
     │ 1. Start Campaign
     ▼
┌─────────────────┐
│  Campaign      │
│  Service       │
│  • Get Sequence│
│  • Get Leads   │
└────┬────────────┘
     │ 2. Queue First Steps
     ▼
┌─────────────────┐
│  Sequence Queue │
│  (BullMQ)       │
└────┬────────────┘
     │ 3. Process Step
     ▼
┌─────────────────┐
│  Sequence       │
│  Worker         │
│  • Check Delay  │
│  • Eval Cond    │
│  • Get Template │
└────┬────────────┘
     │ 4. Queue Email
     ▼
┌─────────────────┐
│  Email Queue    │
└────┬────────────┘
     │ 5. Send Email
     ▼
┌─────────────────┐
│  Email Worker   │
└────┬────────────┘
     │ 6. Email Sent
     ▼
┌─────────────────┐
│  Track Event    │
│  • Update Stats │
│  • Check Reply  │
└────┬────────────┘
     │ 7. Schedule Next Step
     ▼
┌─────────────────┐
│  Sequence Queue │
│  (If conditions)│
└─────────────────┘
```

---

## Database Schema Relationships

```
┌──────────┐
│  Users   │
└────┬─────┘
     │ 1:N
     ├─────────────┐
     │             │
     ▼             ▼
┌──────────┐  ┌──────────┐
│  Teams   │  │ OAuth    │
└────┬─────┘  │Connections│
     │        └──────────┘
     │ N:M
     ▼
┌──────────┐
│Team      │
│Members   │
└──────────┘

┌──────────┐
│ Templates│
└────┬─────┘
     │ 1:N
     ▼
┌──────────┐
│ Sequences│
└────┬─────┘
     │ 1:N
     ▼
┌──────────┐
│Sequence  │
│Steps     │
└────┬─────┘
     │
     │ 1:N
     ▼
┌──────────┐
│ Campaigns│
└────┬─────┘
     │ 1:N
     ├─────────────┐
     │             │
     ▼             ▼
┌──────────┐  ┌──────────┐
│  Leads   │  │  Emails │
└────┬─────┘  └────┬─────┘
     │             │
     │ 1:1        │ 1:N
     ▼             ▼
┌──────────┐  ┌──────────┐
│Research  │  │Clicks    │
│Data      │  │         │
└──────────┘  └──────────┘
```

---

## Component Architecture: Frontend

```
┌─────────────────────────────────────────────────────────┐
│                    App Root                              │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │              Router (React Router)                 │ │
│  └────────────────────────────────────────────────────┘ │
│                          │                               │
│        ┌─────────────────┼─────────────────┐            │
│        │                 │                 │            │
│  ┌─────▼─────┐   ┌───────▼──────┐  ┌───────▼──────┐   │
│  │   Auth    │   │  Dashboard   │  │   Email      │   │
│  │   Pages   │   │   Pages      │  │   Pages      │   │
│  └───────────┘   └──────────────┘  └──────────────┘   │
│        │                 │                 │            │
│  ┌─────▼─────┐   ┌───────▼──────┐  ┌───────▼──────┐   │
│  │ Campaign  │   │  Analytics   │  │   Team      │   │
│  │   Pages   │   │   Pages      │  │   Pages      │   │
│  └───────────┘   └──────────────┘  └──────────────┘   │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │           Shared Components                         │ │
│  │  • Layout  • Forms  • Modals  • Tables             │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │           State Management (Zustand)               │ │
│  │  • Auth Store  • Campaign Store  • UI Store        │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │           API Client (Axios + React Query)          │ │
│  │  • Request Interceptors  • Error Handling          │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## Service Layer Architecture: Backend

```
┌─────────────────────────────────────────────────────────┐
│                    Express App                          │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │              Middleware Stack                       │ │
│  │  • CORS  • Body Parser  • Auth  • Rate Limit      │ │
│  └────────────────────────────────────────────────────┘ │
│                          │                               │
│  ┌────────────────────────────────────────────────────┐ │
│  │                  Routes                              │ │
│  │  /auth  /campaigns  /emails  /templates  /ai        │ │
│  └────────────────────────────────────────────────────┘ │
│                          │                               │
│        ┌─────────────────┼─────────────────┐            │
│        │                 │                 │            │
│  ┌─────▼─────┐   ┌───────▼──────┐  ┌───────▼──────┐   │
│  │Controller│   │  Controller   │  │  Controller  │   │
│  │  Layer    │   │   Layer       │  │   Layer      │   │
│  └─────┬─────┘   └───────┬──────┘  └───────┬──────┘   │
│        │                 │                 │            │
│  ┌─────▼─────┐   ┌───────▼──────┐  ┌───────▼──────┐   │
│  │  Service  │   │   Service    │  │   Service    │   │
│  │   Layer    │   │   Layer      │  │   Layer      │   │
│  └─────┬─────┘   └───────┬──────┘  └───────┬──────┘   │
│        │                 │                 │            │
│  ┌─────▼─────────────────▼─────────────────▼──────┐   │
│  │              Data Access Layer                   │ │
│  │  • Prisma Client  • Redis Client  • External APIs│ │
│  └──────────────────────────────────────────────────┘ │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## Queue & Worker Architecture

```
┌─────────────────────────────────────────────────────────┐
│                    Redis (BullMQ)                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  Email       │  │  Sequence    │  │  Analytics   │ │
│  │  Queue       │  │  Queue       │  │  Queue       │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
│         │                 │                 │           │
└─────────┼─────────────────┼─────────────────┼───────────┘
          │                 │                 │
          ▼                 ▼                 ▼
┌─────────────────┐  ┌──────────────┐  ┌──────────────┐
│  Email Worker   │  │  Sequence    │  │  Analytics   │
│  Pool (5)       │  │  Worker Pool │  │  Worker Pool │
│                 │  │  (3)         │  │  (2)         │
│  • Send Email   │  │  • Execute   │  │  • Process   │
│  • Retry Logic  │  │    Steps     │  │    Events    │
│  • Update Status│  │  • Schedule  │  │  • Calculate│
└─────────────────┘  └──────────────┘  └──────────────┘
```

---

## Security Architecture

```
┌─────────────────────────────────────────────────────────┐
│                    Security Layers                       │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Layer 1: Network Security                              │
│  • WAF (Cloudflare/AWS WAF)                             │
│  • DDoS Protection                                       │
│  • VPC Isolation                                        │
│                                                          │
│  Layer 2: API Gateway Security                          │
│  • Rate Limiting                                         │
│  • IP Whitelisting                                       │
│  • Request Validation                                    │
│                                                          │
│  Layer 3: Application Security                           │
│  • JWT Authentication                                    │
│  • OAuth 2.0                                             │
│  • Role-Based Access Control (RBAC)                     │
│  • Input Validation                                      │
│  • SQL Injection Prevention                              │
│                                                          │
│  Layer 4: Data Security                                  │
│  • Encryption at Rest (AES-256)                          │
│  • Encryption in Transit (TLS 1.3)                       │
│  • Token Encryption                                      │
│  • Secrets Management                                    │
│                                                          │
│  Layer 5: Monitoring & Compliance                       │
│  • Audit Logs                                            │
│  • Security Monitoring                                   │
│  • GDPR Compliance                                       │
│  • SOC 2 Compliance                                      │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────┐
│                    Load Balancer                         │
│                  (AWS ALB / GCP LB)                      │
└────────────────────────┬────────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ▼                ▼                ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  Web App     │  │  Web App     │  │  Web App     │
│  Instance 1  │  │  Instance 2  │  │  Instance 3  │
└──────────────┘  └──────────────┘  └──────────────┘
        │                │                │
        └────────────────┼────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│                    API Gateway                           │
└────────────────────────┬────────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ▼                ▼                ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  API Server  │  │  API Server  │  │  API Server  │
│  Instance 1  │  │  Instance 2  │  │  Instance 3  │
└──────────────┘  └──────────────┘  └──────────────┘
        │                │                │
        └────────────────┼────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ▼                ▼                ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  Worker Pool │  │  Worker Pool │  │  Worker Pool │
│  (Email)     │  │  (Sequence)  │  │  (Analytics) │
└──────────────┘  └──────────────┘  └──────────────┘
        │                │                │
        └────────────────┼────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ▼                ▼                ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  PostgreSQL  │  │    Redis     │  │  Elasticsearch│
│  (Primary +  │  │  (Cluster)   │  │  (Cluster)   │
│   Replicas)  │  │              │  │              │
└──────────────┘  └──────────────┘  └──────────────┘
```

---

## Integration Architecture

```
┌─────────────────────────────────────────────────────────┐
│                  Integration Service                     │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  Salesforce │  │   HubSpot    │  │  Pipedrive   │ │
│  │  Adapter     │  │   Adapter    │  │  Adapter     │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
│         │                 │                 │           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  Calendly    │  │   Slack      │  │   Zapier     │ │
│  │  Adapter     │  │   Adapter    │  │  Adapter     │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │              Common Integration Interface           │ │
│  │  • OAuth Management                                 │ │
│  │  • Token Refresh                                   │ │
│  │  • Error Handling                                  │ │
│  │  • Rate Limiting                                   │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
└─────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────┐
│                  Sync Workers                            │
│  • Two-way Sync                                          │
│  • Conflict Resolution                                   │
│  • Webhook Processing                                    │
└─────────────────────────────────────────────────────────┘
```

---

*Last Updated: [Current Date]*
*Version: 1.0*

